import{e as m,o as a,c as l,a as i,f as p,w as f,v as g,F as h,r as I,g as v,t as b,p as y,h as x,i as D,j as _}from"./entry.WGPU2Ymh.js";const k={emits:["scanresult"],data(){return{Zxing:null,VideoInputDevices:[],SelectedDeviceId:null,Scanning:!1}},mounted(){this.initDevices()},methods:{async initDevices(){let e=this,{$zxing:t}=v();e.Zxing=t;try{(await navigator.mediaDevices.getUserMedia({video:!0})).getTracks().forEach(s=>s.stop());const o=await navigator.mediaDevices.enumerateDevices();e.VideoInputDevices=o.filter(s=>s.kind==="videoinput"),e.VideoInputDevices.length>0&&(e.SelectedDeviceId=e.VideoInputDevices[0].deviceId)}catch(n){console.error(n)}},startScanning(){let e=this;e.SelectedDeviceId&&(e.Zxing&&e.Scanning&&e.stopScanning(),e.Scanning=!0,e.Zxing.multiFormatReader.decodeFromVideoDevice(e.SelectedDeviceId,document.getElementById("video"),(t,n)=>{t&&e.handleScanResult(t.text),n&&!(n instanceof e.Zxing.notFoundException)&&console.error(n)}))},handleScanResult(e){let t=this;t.stopScanning(),confirm("掃描到條碼："+e+"，是否正確？")?t.$emit("scanresult",e):t.initScanner()},stopScanning(){let e=this;e.Zxing&&(e.Zxing.multiFormatReader.reset(),e.Scanning=!1)}},beforeDestroy(){this.stopScanning()}},w=e=>(y("data-v-43c2a449"),e=e(),x(),e),C={class:"mb-3"},V=["value"],B=w(()=>i("video",{id:"video",autoplay:"",playsinline:""},null,-1));function E(e,t,n,r,o,s){return a(),l(h,null,[i("div",C,[o.Scanning?p("",!0):(a(),l("button",{key:0,type:"button",class:"btn btn-primary",onClick:t[0]||(t[0]=(...c)=>s.startScanning&&s.startScanning(...c))},"開始掃描")),o.Scanning?(a(),l("button",{key:1,type:"button",class:"btn btn-warning",onClick:t[1]||(t[1]=(...c)=>s.stopScanning&&s.stopScanning(...c))},"停止掃描")):p("",!0)]),o.VideoInputDevices.length>0?f((a(),l("select",{key:0,class:"form-select mb-3","aria-label":"Default select example","onUpdate:modelValue":t[2]||(t[2]=c=>o.SelectedDeviceId=c)},[(a(!0),l(h,null,I(o.VideoInputDevices,c=>(a(),l("option",{key:c.deviceId,value:c.deviceId},b(c.label||`Camera ${c.deviceId}`),9,V))),128))],512)),[[g,o.SelectedDeviceId]]):p("",!0),B],64)}const R=m(k,[["render",E],["__scopeId","data-v-43c2a449"]]),T={mounted(){this.startScanner()},methods:{startScanner(){let e=this,{$qrcode:t}=v(),n=function(s,c){let u=.7,d=Math.min(s,c),S=Math.floor(d*u);return{width:S,height:S}},r=[t.html5QrcodeScanType.SCAN_TYPE_CAMERA,t.html5QrcodeScanType.SCAN_TYPE_FILE],o={fps:5,qrbox:n,supportedScanTypes:r,useBarCodeDetectorIfSupported:!0,rememberLastUsedCamera:!0,aspectRatio:4/3,showTorchButtonIfSupported:!0,showZoomSliderIfSupported:!0,defaultZoomValueIfSupported:2};e.QrcodeScanner=t.html5QrcodeScanner("scanner",o,!1),e.QrcodeScanner.render(e.onScanSuccess)},onScanSuccess(e,t){let n=this;n.QrcodeScanner.clear().then(function(){n.$emit("scanresult",e)}).catch(r=>{console.error(r),alert(r)})}}},$={id:"scanner",style:{width:"auto",height:"auto"}};function q(e,t,n,r,o,s){return a(),l("div",$)}const Z=m(T,[["render",q]]),F={data(){return{IsOneDimensional:!1}},methods:{onButtonClick(){let e=this,n=document.getElementById("qrcodeInput").value;e.send(n)},passvalue(e){this.send(e)},send(e){this.$router.push(`scan/result?qrcode=${e}`)}}},M={class:"container py-3"},Q={class:"input-group"},A=i("input",{type:"text",class:"form-control",placeholder:"手動輸入條碼","aria-label":"Recipient's username","aria-describedby":"button-addon2",id:"qrcodeInput"},null,-1),N={class:"container py-3"},z={class:"card"},O=i("div",{class:"card-header text-center"}," 掃描區塊 ",-1),U={class:"card-body"},L={class:"form-check form-switch"},P=i("label",{class:"form-check-label",for:"switchTool"},"掃瞄一維條碼",-1),Y=i("br",null,null,-1);function j(e,t,n,r,o,s){const c=R,u=Z;return a(),l(h,null,[i("div",M,[i("div",Q,[A,i("button",{class:"btn btn-outline-secondary",type:"button",id:"button-addon2",onClick:t[0]||(t[0]=(...d)=>s.onButtonClick&&s.onButtonClick(...d))},"送出")])]),i("div",N,[i("div",z,[O,i("div",U,[i("div",L,[f(i("input",{class:"form-check-input",type:"checkbox",role:"switch",id:"switchTool","onUpdate:modelValue":t[1]||(t[1]=d=>o.IsOneDimensional=d)},null,512),[[D,o.IsOneDimensional]]),P]),Y,o.IsOneDimensional?(a(),_(c,{key:0,onScanresult:s.passvalue},null,8,["onScanresult"])):(a(),_(u,{key:1,onScanresult:s.passvalue},null,8,["onScanresult"]))])])])],64)}const H=m(F,[["render",j]]);export{H as default};
